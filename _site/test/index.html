<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parallax Effect Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }
      .parallax-container {
        width: 300px;
        height: 400px;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
        margin: 0 20px;
        transition: transform 0.1s ease-out;
      }
      .background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #ff9a9e, #fad0c4);
        transition: transform 0.1s ease-out;
      }
      .content {
        position: relative;
        z-index: 1;
        padding: 20px;
        color: #333;
        transition: transform 0.1s ease-out;
      }
      .spotlight {
        position: absolute;
        background: radial-gradient(
          circle at var(--mouse-x) var(--mouse-y),
          rgba(255, 255, 255, 0.4) 0%,
          rgba(255, 255, 255, 0) 80%
        );
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.1s ease-out;
      }
    </style>
  </head>
  <body>
    <div class="parallax-container" id="card1">
      <div class="background"></div>
      <div class="content">
        <h2>Parallax Card 1</h2>
        <p>
          Move your mouse over this card to see the parallax effect in action!
        </p>
      </div>
      <div class="spotlight"></div>
    </div>

    <div class="parallax-container" id="card2">
      <div class="background"></div>
      <div class="content">
        <h2>Parallax Card 2</h2>
        <p>This card has different parallax settings. Try it out!</p>
      </div>
      <div class="spotlight"></div>
    </div>

    <script>
      class ParallaxEffect {
        constructor(container, options = {}) {
          this.container = container;
          this.options = {
            multiplier: 0.001,
            rotationFactor: 0.5,
            backgroundMoveFactor: 0.05,
            contentMoveFactor: 0.03,
            spotlightSizeIncrease: 1.15,
            ...options,
          };
          this.state = {
            width: 0,
            height: 0,
          };
          this.elements = {
            background: container.querySelector(".background"),
            content: container.querySelector(".content"),
            spotlight: container.querySelector(".spotlight"),
          };

          this.init();
        }

        handleMouseMove(e) {
          this.updateParallax(e);
          this.updateSpotlight(e);
        }

        updateParallax(e) {
          const { x: mouseX, y: mouseY } = this.calculateMousePosition(e);
          const { width, height } = this.state;
          const {
            multiplier,
            rotationFactor,
            backgroundMoveFactor,
            contentMoveFactor,
          } = this.options;

          const mousePX = (mouseX - width / 2) / width;
          const mousePY = (mouseY - height / 2) / height;

          const rX = mousePY * rotationFactor;
          const rY = mousePX * -rotationFactor;

          this.container.style.transform = `rotateX(${rX}deg) rotateY(${rY}deg)`;

          if (this.elements.background) {
            this.elements.background.style.transform = `translate(${
              mousePX * backgroundMoveFactor * 100
            }px, ${mousePY * backgroundMoveFactor * 100}px)`;
          }

          if (this.elements.content) {
            const contentTransform = `translate(${
              mousePX * contentMoveFactor * 100
            }px, ${mousePY * contentMoveFactor * 100}px)`;
            this.elements.content.style.transform = contentTransform;
            if (this.elements.spotlight) {
              this.elements.spotlight.style.transform = contentTransform;
            }
          }
        }

        updateSpotlight(e) {
          if (!this.elements.spotlight || !this.elements.content) return;

          const contentRect = this.elements.content.getBoundingClientRect();
          const containerRect = this.container.getBoundingClientRect();
          const mousePos = this.calculateMousePosition(e);

          if (this.isPointInRect(mousePos, contentRect)) {
            const spotlightCenterX =
              ((mousePos.x - (contentRect.left - containerRect.left)) /
                contentRect.width) *
              100;
            const spotlightCenterY =
              ((mousePos.y - (contentRect.top - containerRect.top)) /
                contentRect.height) *
              100;

            const spotlightWidth =
              contentRect.width * this.options.spotlightSizeIncrease;
            const spotlightHeight =
              contentRect.height * this.options.spotlightSizeIncrease;

            const leftOffset = (spotlightWidth - contentRect.width) / 2;
            const topOffset = (spotlightHeight - contentRect.height) / 2;

            Object.assign(this.elements.spotlight.style, {
              left: `${contentRect.left - containerRect.left - leftOffset}px`,
              top: `${contentRect.top - containerRect.top - topOffset}px`,
              width: `${spotlightWidth}px`,
              height: `${spotlightHeight}px`,
              opacity: "1",
            });

            this.elements.spotlight.style.setProperty(
              "--mouse-x",
              `${spotlightCenterX}%`
            );
            this.elements.spotlight.style.setProperty(
              "--mouse-y",
              `${spotlightCenterY}%`
            );
          } else {
            this.elements.spotlight.style.opacity = "0";
          }
        }

        handleMouseLeave() {
          const resetTransform = "translate(0, 0)";
          this.container.style.transform = "rotateX(0deg) rotateY(0deg)";
          if (this.elements.background)
            this.elements.background.style.transform = resetTransform;
          if (this.elements.content)
            this.elements.content.style.transform = resetTransform;
          if (this.elements.spotlight) {
            this.elements.spotlight.style.transform = resetTransform;
            this.elements.spotlight.style.opacity = "0";
          }
        }

        handleResize() {
          this.state.width = this.container.offsetWidth;
          this.state.height = this.container.offsetHeight;
        }

        init() {
          this.container.addEventListener(
            "mousemove",
            this.handleMouseMove.bind(this)
          );
          this.container.addEventListener(
            "mouseleave",
            this.handleMouseLeave.bind(this)
          );
          window.addEventListener(
            "resize",
            this.debounce(this.handleResize.bind(this), 250)
          );
          this.handleResize();
        }

        calculateMousePosition(e) {
          const rect = this.container.getBoundingClientRect();
          return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top,
          };
        }

        isPointInRect(point, rect) {
          return (
            point.x >= 0 &&
            point.x <= rect.width &&
            point.y >= 0 &&
            point.y <= rect.height
          );
        }

        debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }
      }

      function createParallaxEffects(configs) {
        return configs.map(({ selector, options = {} }) => {
          const container = document.querySelector(selector);
          return new ParallaxEffect(container, options);
        });
      }

      // Initialize parallax effects
      const parallaxEffects = createParallaxEffects([
        {
          selector: "#card1",
          options: {
            multiplier: 0.001,
            rotationFactor: 1,
            backgroundMoveFactor: 0.05,
            contentMoveFactor: 0.03,
          },
        },
        {
          selector: "#card2",
          options: {
            multiplier: 0.0015,
            rotationFactor: 1,
            backgroundMoveFactor: 0.08,
            contentMoveFactor: 0.05,
          },
        },
      ]);
    </script>
  </body>
</html>
